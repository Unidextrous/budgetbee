#:kivy 2.0

<DashboardScreen>:
    BoxLayout:
        orientation: "vertical"
        spacing: 10
        padding: 10
        Label:
            text: "BudgetBee Dashboard"
            font_size: 32
        Label:
            text: "Total Balance: $" + root.total_balance
            font_size: 24
            size_hint_y: None
            height: 16
        Label:
            text: "Total Checking: $" + root.checking_balance
            font_size: 16
            size_hint_y: None
            height: 16
        Label:
            text: "Total Savings: $" + root.savings_balance
            font_size: 16
            size_hint_y: None
            height: 16
        Label:
            text: "Total Benefits: $" + root.benefits_balance
            font_size: 16
            size_hint_y: None
            height: 16
        Button:
            text: "Accounts"
            on_release: app.root.current = "accounts"
        Button:
            text: "Categories"
            on_release: app.root.current = "categories"
        Button:
            text: "Transactions"
            on_release: app.root.current = "transactions"
        Button:
            text: "Budgets"
            on_release: app.root.current = "budgets"
        Button:
            text: "Compare Categories (Pie Chart)"
            on_release: app.root.current = "category_pie_chart"

<AccountsScreen>:
    BoxLayout:
        orientation: "vertical"
        spacing: 10
        padding: 10
        Label:
            text: "Accounts"
            font_size: 28
        ScrollView:
            GridLayout:
                id: accts_list
                cols: 1
                size_hint_y: None
        Button:
            text: "Add Account"
            on_release: app.root.current = "add_account"
        Button:
            text: "Back"
            on_release: app.root.current = "dashboard"

<AddAccountScreen>:
    BoxLayout:
        orientation: "vertical"
        spacing: 10
        padding: 10
        Spinner:
            id: type_spinner
            text: "Checking"   # default
            values: ["Checking", "Savings", "Benefits"]
        TextInput:
            id: owner
            hint_text: "Account Owner"
        TextInput:
            id: name
            hint_text: "Account Name"
        TextInput:
            id: balance
            hint_text: "Balance"
            input_filter: "float"
        Button:
            text: "Save Account"
            on_release: root.add_account(owner.text, name.text, balance.text)
        Button:
            text: "Back"
            on_release: app.root.current = "accounts"

<EditAccountScreen>:
    BoxLayout:
        orientation: "vertical"
        spacing: 10
        padding: 10
        Spinner:
            id: type_spinner
            values: ["Checking", "Savings", "Benefits"]
        TextInput:
            id: owner
            hint_text: "Account Owner"
        TextInput:
            id: name
            hint_text: "Account Name"
        TextInput:
            id: balance
            hint_text: "Balance"
            input_filter: "float"
        Button:
            text: "Save Account"
            on_release: root.save_account()
        Button:
            text: "Back"
            on_release: app.root.current = "accounts"
        
<CategoriesScreen>:
    BoxLayout:
        orientation: "vertical"
        spacing: 10
        padding: 10
        Label:
            text: "Categories"
            font_size: 28
        ScrollView:
            GridLayout:
                id: cats_list
                cols: 1
                size_hint_y: None
        Button:
            text: "Add Category"
            on_release: app.root.current = "add_category"
        Button:
            text: "Back"
            on_release: app.root.current = "dashboard"

<AddCategoryScreen>:
    BoxLayout:
        orientation: "vertical"
        spacing: 10
        padding: 10
        TextInput:
            id: name
            hint_text: "Category Name"
        BoxLayout:
            orientation: "horizontal"
            ToggleButton:
                id: income_btn
                text: "Income"
                group: "type"
            ToggleButton:
                id: expense_btn
                text: "Expense"
                group: "type"
        Button:
            text: "Save Category"
            on_release: root.add_category(name.text, "Income" if income_btn.state == "down" else ("Expense" if expense_btn.state == "down" else ""))
        Button:
            text: "Back"
            on_release: app.root.current = "categories"

<EditCategoryScreen>:
    BoxLayout:
        orientation: "vertical"
        spacing: 10
        padding: 10
        TextInput:
            id: name
            hint_text: "Category Name"
        BoxLayout:
            orientation: "horizontal"
            ToggleButton:
                id: income_btn
                text: "Income"
                group: "type"
            ToggleButton:
                id: expense_btn
                text: "Expense"
                group: "type"
        Button:
            text: "Save Category"
            on_release: root.save_category()
        Button:
            text: "Back"
            on_release: app.root.current = "categories"

<TransactionsScreen>:
    BoxLayout:
        orientation: "vertical"
        spacing: 10
        padding: 10
        Label:
            text: "Transactions"
            font_size: 28
        ScrollView:
            GridLayout:
                id: txns_list
                cols: 1
                size_hint_y: None
        Button:
            text: "Add Transaction"
            on_release: app.root.current = "add_transaction"
        Button:
            text: "Back"
            on_release: app.root.current = "dashboard"

<AddTransactionScreen>:
    account_spinner: account_spinner
    category_spinner: category_spinner
    BoxLayout:
        orientation: "vertical"
        spacing: 10
        padding: 10
        Spinner:
            id: account_spinner
            text: "Select Account"
            values: []
        Spinner:
            id: category_spinner
            text: "Select Category"
            values: []
        TextInput:
            id: amount
            hint_text: "Amount"
            input_filter: "float"
        BoxLayout:
            orientation: "horizontal"
            spacing: 5
            TextInput:
                id: date
                hint_text: "Date (YYYY-MM-DD)"
                readonly: True
            Button:
                text: "Pick Date"
                size_hint_x: None
                width: 100
                on_release: root.open_calendar(date)
        TextInput:
            id: description
            hint_text: "Description"
        Button:
            text: "Save Transaction"
            on_release: root.add_transaction(account_spinner.text, category_spinner.text, amount.text, date.text, description.text)
        Button:
            text: "Back"
            on_release: app.root.current = "transactions"

<EditTransactionScreen>
    BoxLayout:
        orientation: "vertical"
        spacing: 10
        padding: 10
        Spinner:
            id: account_spinner
            text: "Select Account"
            values: root.get_account_names()

        Spinner:
            id: category_spinner
            text: "Select Category"

        TextInput:
            id: amount
            hint_text: "Transaction Amount"
            input_filter: "float"

        BoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            height: 40
            spacing: 5

            TextInput:
                id: date
                hint_text: "Date (YYYY-MM-DD)"
                readonly: True

            Button:
                text: "Pick Date"
                size_hint_x: None
                width: 100
                on_release: root.open_calendar(root.ids.date)

        TextInput:
            id: description
            hint_text: "Description"

        Button:
            text: "Save Transaction"
            on_release: root.save_transaction()

        Button:
            text: "Back"
            on_release: app.root.current = "transactions"

<BudgetsScreen>:
    BoxLayout:
        orientation: "vertical"
        spacing: 10
        padding: 10
        Label:
            text: "Budgets"
            font_size: 28
        ScrollView:
            GridLayout:
                id: budgets_list
                cols: 1
                size_hint_y: None
        Button:
            text: "Add Budget"
            on_release: app.root.current = "add_budget"
        Button:
            text: "Back"
            on_release: app.root.current = "dashboard"

<AddBudgetScreen>:
    BoxLayout:
        orientation: "vertical"
        spacing: 10
        padding: 10
        TextInput:
            id: budget_name
            hint_text: "Budget Name"
        BoxLayout:
            orientation: "horizontal"
            spacing: 5
            TextInput:
                id: start_date
                hint_text: "Start Date (YYYY-MM-DD)"
                readonly: True
            Button:
                text: "Pick Date"
                size_hint_x: None
                width: 100
                on_release: root.open_calendar(start_date)
        Button:
            text: "Save Budget"
            on_release: root.add_budget(budget_name.text, start_date.text)
        Button:
            text: "Back"
            on_release: app.root.current = "budgets"

<BudgetSummaryScreen>:
    BoxLayout:
        orientation: "vertical"
        padding: 10
        spacing: 10

        BoxLayout:
            id: header_box
            orientation: "horizontal"

            Label:
                id: budget_header
                font_size: 18
                bold: True
            Button:
                text: "Edit"
                size_hint_x: None
                width: 80
                on_release: root.edit_budget()

        BoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            height: 30
            spacing: 10
            Label:
                id: allocated_label
                text: ""
                size_hint_y: None
                height: 30
            Label:
                id: projected_label
                text: ""
                size_hint_y: None
                height: 30
            Label:
                id: spent_label
                text: ""
                size_hint_y: None
                height: 30
            Label:
                id: remaining_label
                text: ""
                size_hint_y: None
                height: 30

        # ------------------------------
        # Add Allocated Category Section
        # ------------------------------
        Label:
            text: "Add Allocated Category"
            font_size: 22
        BoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            height: 40
            spacing: 5
            Spinner:
                id: alloc_category_spinner
                text: "Select Category"
                values: []
            TextInput:
                id: alloc_amount
                hint_text: "Amount"
                input_filter: "float"
            TextInput:
                id: alloc_desc
                hint_text: "Description"
            Button:
                text: "Add"
                size_hint_x: None
                width: 80
                on_release: root.add_budgeted_category(alloc_category_spinner.text, alloc_amount.text, alloc_desc.text)

        Label:
            text: "Allocated Categories"
            font_size: 22
        ScrollView:
            GridLayout:
                id: allocated_list
                cols: 1
                size_hint_y: None

        # ------------------------------
        # Add Projected Transaction Section
        # ------------------------------
        Label:
            text: "Add Projected Transaction"
            font_size: 22
        BoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            height: 40
            spacing: 5
            Spinner:
                id: proj_category_spinner
                text: "Select Category"
                values: []
            TextInput:
                id: proj_amount
                hint_text: "Amount"
                input_filter: "float"
            TextInput:
                id: proj_desc
                hint_text: "Description"
            BoxLayout:
                orientation: "horizontal"
                spacing: 5
                TextInput:
                    id: proj_date
                    hint_text: "Projected Date (YYYY-MM-DD)"
                    readonly: True
                Button:
                    text: "Pick Date"
                    size_hint_x: None
                    width: 100
                    on_release: root.open_calendar(proj_date)
            Button:
                text: "Add"
                size_hint_x: None
                width: 80
                on_release: root.add_projected_transaction(proj_category_spinner.text, proj_amount.text, proj_desc.text, proj_date.text)

        Label:
            text: "Projected Transactions"
            font_size: 22
        ScrollView:
            GridLayout:
                id: projected_list
                cols: 1
                size_hint_y: None

        Button:
            text: "Back"
            size_hint_y: None
            height: 40
            on_release: app.root.current = "budgets"